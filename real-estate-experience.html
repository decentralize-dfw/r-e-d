<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Riverside Apartments</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .ui-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .ui-layer > * {
            pointer-events: auto;
        }

        /* Hero Screen */
        #hero-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        #hero-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .hero-title {
            font-size: 72px;
            font-weight: 300;
            letter-spacing: 8px;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .hero-subtitle {
            font-size: 18px;
            font-weight: 300;
            letter-spacing: 4px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 60px;
        }

        .scroll-indicator {
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .btn-start {
            padding: 18px 48px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            font-size: 14px;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn-start:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.6);
            transform: scale(1.05);
        }

        /* Stats Panel */
        #stats-panel {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%) translateX(-400px);
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #stats-panel.visible {
            transform: translateY(-50%) translateX(0);
            opacity: 1;
        }

        .stat-box {
            background: rgba(17, 17, 17, 0.8);
            backdrop-filter: blur(10px);
            padding: 24px 32px;
            margin-bottom: 16px;
            border-left: 3px solid rgba(255,255,255,0.3);
            min-width: 300px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
            letter-spacing: 1px;
        }

        /* Filter Panel */
        #filter-panel {
            position: absolute;
            left: 40px;
            top: 120px;
            width: 320px;
            background: rgba(17, 17, 17, 0.85);
            backdrop-filter: blur(10px);
            padding: 32px;
            transform: translateX(-400px);
            opacity: 0;
            transition: all 0.6s ease;
        }

        #filter-panel.visible {
            transform: translateX(0);
            opacity: 1;
        }

        .filter-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            letter-spacing: 1px;
        }

        .filter-group {
            margin-bottom: 28px;
        }

        .filter-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 12px;
            display: block;
        }

        .room-buttons {
            display: flex;
            gap: 8px;
        }

        .room-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .room-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
        }

        .room-btn.active {
            background: rgba(255,255,255,0.15);
            border-color: #fff;
            color: #fff;
        }

        .range-slider {
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.2);
            position: relative;
            margin: 16px 0;
        }

        .range-value {
            font-size: 14px;
            color: #fff;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            cursor: pointer;
        }

        .checkbox-item input {
            margin-right: 12px;
            width: 18px;
            height: 18px;
        }

        /* Navigation */
        #nav-controls {
            position: absolute;
            bottom: 40px;
            right: 40px;
            display: flex;
            gap: 16px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #nav-controls.visible {
            opacity: 1;
        }

        .nav-btn {
            padding: 16px 32px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            font-size: 13px;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Apartment Info Tooltip */
        #apt-tooltip {
            position: absolute;
            background: rgba(17, 17, 17, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            white-space: nowrap;
        }

        #apt-tooltip.visible {
            opacity: 1;
        }

        /* Floor Plan Panel */
        #floorplan-panel {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 600px;
            background: rgba(17, 17, 17, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-top: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #floorplan-panel.visible {
            transform: translateX(-50%) translateY(0);
        }

        .floorplan-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .floorplan-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .room-link {
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .room-link:hover {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.4);
        }

        /* Amenities Menu */
        #amenities-menu {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%) translateX(-400px);
            opacity: 0;
            transition: all 0.6s ease;
            width: 320px;
        }

        #amenities-menu.visible {
            transform: translateY(-50%) translateX(0);
            opacity: 1;
        }

        .amenity-item {
            background: rgba(17, 17, 17, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px 24px;
            margin-bottom: 12px;
            border-left: 3px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .amenity-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: #fff;
            transform: translateX(10px);
        }

        .amenity-number {
            font-size: 24px;
            font-weight: 300;
            color: rgba(255,255,255,0.4);
        }

        .amenity-name {
            font-size: 14px;
            letter-spacing: 1px;
        }

        /* Loading */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        #loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scene Title */
        #scene-title {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.6);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #scene-title.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loader"></div>
    </div>

    <div id="canvas-container"></div>

    <div class="ui-layer">
        <!-- Hero Screen -->
        <div id="hero-screen">
            <div class="hero-title">RIVERSIDE LIVING</div>
            <div class="hero-subtitle">Luxury Apartments by the Water</div>
            <button class="btn-start" onclick="startExperience()">BEGIN TOUR</button>
        </div>

        <!-- Scene Title -->
        <div id="scene-title"></div>

        <!-- Stats Panel -->
        <div id="stats-panel">
            <div class="stat-box">
                <div class="stat-value">5 Minutes</div>
                <div class="stat-label">TO METRO STATION</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">17 Minutes</div>
                <div class="stat-label">TO SHOPPING CENTER</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">10 Minutes</div>
                <div class="stat-label">TO CITY CENTER</div>
            </div>
        </div>

        <!-- Filter Panel -->
        <div id="filter-panel">
            <div class="filter-title">Find Your Home</div>

            <div class="filter-group">
                <label class="filter-label">Rooms</label>
                <div class="room-buttons">
                    <button class="room-btn" data-rooms="1">1</button>
                    <button class="room-btn active" data-rooms="2">2</button>
                    <button class="room-btn" data-rooms="3">3</button>
                    <button class="room-btn" data-rooms="4">4</button>
                </div>
            </div>

            <div class="filter-group">
                <label class="filter-label">Price Range</label>
                <div class="range-value">$250,000 - $500,000</div>
            </div>

            <div class="filter-group">
                <label class="filter-label">Area (m²)</label>
                <div class="range-value">45 - 120 m²</div>
            </div>

            <div class="filter-group">
                <label class="filter-label">Features</label>
                <div class="checkbox-item">
                    <input type="checkbox" id="terrace">
                    <label for="terrace">Terrace</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="whitebox">
                    <label for="whitebox">White Box Finishing</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="bathrooms">
                    <label for="bathrooms">2 Bathrooms</label>
                </div>
            </div>
        </div>

        <!-- Apartment Tooltip -->
        <div id="apt-tooltip"></div>

        <!-- Floor Plan Panel -->
        <div id="floorplan-panel">
            <div class="floorplan-title">Apartment #345 - 2 Rooms, 65m²</div>
            <div style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px;">
                Floor 7 | South Facing | Available
            </div>
            <div class="floorplan-grid">
                <div class="room-link" onclick="goToRoom('living')">Living Room</div>
                <div class="room-link" onclick="goToRoom('bedroom')">Bedroom</div>
                <div class="room-link" onclick="goToRoom('kitchen')">Kitchen</div>
                <div class="room-link" onclick="goToRoom('bathroom')">Bathroom</div>
                <div class="room-link" onclick="goToRoom('balcony')">Balcony</div>
                <div class="room-link" onclick="goToRoom('hall')">Hallway</div>
            </div>
            <div style="margin-top: 24px; display: flex; gap: 12px;">
                <button class="nav-btn" style="flex: 1;">Download PDF</button>
                <button class="nav-btn" style="flex: 1;" onclick="startWalkthrough()">Start Walkthrough</button>
            </div>
        </div>

        <!-- Amenities Menu -->
        <div id="amenities-menu">
            <div class="amenity-item" onclick="showAmenity('playground')">
                <div class="amenity-number">01</div>
                <div class="amenity-name">PLAYGROUND</div>
            </div>
            <div class="amenity-item" onclick="showAmenity('garden')">
                <div class="amenity-number">02</div>
                <div class="amenity-name">ROOF GARDEN</div>
            </div>
            <div class="amenity-item" onclick="showAmenity('sports')">
                <div class="amenity-number">03</div>
                <div class="amenity-name">SPORTS GROUND</div>
            </div>
            <div class="amenity-item" onclick="showAmenity('shopping')">
                <div class="amenity-number">04</div>
                <div class="amenity-name">SHOPPING CENTER</div>
            </div>
            <div class="amenity-item" onclick="showAmenity('parking')">
                <div class="amenity-number">05</div>
                <div class="amenity-name">MULTILEVEL PARKING</div>
            </div>
            <div class="amenity-item" onclick="showAmenity('parks')">
                <div class="amenity-number">06</div>
                <div class="amenity-name">PARKS & GARDENS</div>
            </div>
            <div class="amenity-item" onclick="showAmenity('cinema')">
                <div class="amenity-number">07</div>
                <div class="amenity-name">CINEMA</div>
            </div>
        </div>

        <!-- Navigation -->
        <div id="nav-controls">
            <button class="nav-btn" onclick="previousScene()">Previous</button>
            <button class="nav-btn" onclick="nextScene()">Next</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // GLOBAL STATE
        let scene, camera, renderer, raycaster, mouse;
        let currentScene = 0;
        let sceneObjects = {};
        let selectedApartment = null;
        let controls = null;
        let animating = false;

        // SCENES CONFIGURATION
        const SCENES = {
            0: { name: 'HERO', camera: { pos: [80, 40, 80], look: [0, 10, 0] } },
            1: { name: 'NEIGHBORHOOD', camera: { pos: [100, 60, 100], look: [0, 0, 0] } },
            2: { name: 'AMENITIES', camera: { pos: [60, 35, 60], look: [0, 5, 0] } },
            3: { name: 'BUILDING', camera: { pos: [40, 25, 40], look: [0, 15, 0] } },
            4: { name: 'FLOOR_SELECT', camera: { pos: [25, 20, 25], look: [0, 20, 0] } },
            5: { name: 'APARTMENT', camera: { pos: [15, 20, 15], look: [0, 20, 0] } },
            6: { name: 'INTERIOR', camera: { pos: [2, 1.6, 3], look: [0, 1.6, 0] } },
            7: { name: 'FEATURES', camera: { pos: [50, 30, 50], look: [0, 10, 0] } }
        };

        // INITIALIZATION
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1520);
            scene.fog = new THREE.Fog(0x1a1520, 80, 200);

            // Camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(...SCENES[0].camera.pos);
            camera.lookAt(...SCENES[0].camera.look);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Raycaster & Mouse
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Lights
            const sunLight = new THREE.DirectionalLight(0xffaa88, 1.5);
            sunLight.position.set(50, 40, 30);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            sunLight.shadow.camera.left = -50;
            sunLight.shadow.camera.right = 50;
            sunLight.shadow.camera.top = 50;
            sunLight.shadow.camera.bottom = -50;
            scene.add(sunLight);

            const skyLight = new THREE.HemisphereLight(0xff9977, 0x4455aa, 0.6);
            scene.add(skyLight);

            const ambientLight = new THREE.AmbientLight(0x665577, 0.4);
            scene.add(ambientLight);

            // Build Scene
            createEnvironment();
            createNeighborhood();
            createMainBuilding();
            createAmenities();
            createInterior();

            // Events
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onMouseClick);

            // Filter buttons
            document.querySelectorAll('.room-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterApartments();
                });
            });

            // Start animation
            animate();

            // Hide loading
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 500);
        }

        function createEnvironment() {
            // Ground
            const groundGeo = new THREE.PlaneGeometry(300, 300);
            const groundMat = new THREE.MeshStandardMaterial({
                color: 0x2a2a2a,
                roughness: 0.9
            });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // River
            const riverGeo = new THREE.PlaneGeometry(40, 200);
            const riverMat = new THREE.MeshStandardMaterial({
                color: 0x334466,
                roughness: 0.3,
                metalness: 0.6
            });
            const river = new THREE.Mesh(riverGeo, riverMat);
            river.rotation.x = -Math.PI / 2;
            river.position.set(-60, 0.1, 0);
            river.receiveShadow = true;
            scene.add(river);

            // Trees along river
            for (let i = 0; i < 20; i++) {
                const tree = createTree();
                tree.position.set(-40 + Math.random() * 10, 0, -80 + i * 8);
                scene.add(tree);
            }
        }

        function createTree() {
            const tree = new THREE.Group();

            const trunkGeo = new THREE.CylinderGeometry(0.3, 0.4, 4);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x4a3828 });
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.castShadow = true;
            tree.add(trunk);

            const leavesGeo = new THREE.SphereGeometry(2, 8, 8);
            const leavesMat = new THREE.MeshStandardMaterial({ color: 0x2d5016 });
            const leaves = new THREE.Mesh(leavesGeo, leavesMat);
            leaves.position.y = 3;
            leaves.castShadow = true;
            tree.add(leaves);

            return tree;
        }

        function createNeighborhood() {
            sceneObjects.neighborhood = new THREE.Group();

            // Context buildings (low detail)
            const buildingPositions = [
                [-40, 15, -40], [-40, 12, -20], [-40, 18, 0],
                [40, 14, -40], [40, 16, -20], [40, 11, 0],
                [-20, 13, -50], [20, 15, -50],
                [-30, 10, 40], [30, 12, 40]
            ];

            buildingPositions.forEach(([x, h, z]) => {
                const buildingGeo = new THREE.BoxGeometry(8, h * 2, 8);
                const buildingMat = new THREE.MeshStandardMaterial({
                    color: 0x3a3a3a,
                    roughness: 0.8,
                    transparent: true,
                    opacity: 0.4
                });
                const building = new THREE.Mesh(buildingGeo, buildingMat);
                building.position.set(x, h, z);
                building.castShadow = true;
                building.receiveShadow = true;
                sceneObjects.neighborhood.add(building);
            });

            scene.add(sceneObjects.neighborhood);
        }

        function createMainBuilding() {
            sceneObjects.building = new THREE.Group();
            sceneObjects.apartments = [];

            const floors = 12;
            const aptsPerFloor = 4;

            for (let floor = 0; floor < floors; floor++) {
                for (let apt = 0; apt < aptsPerFloor; apt++) {
                    const aptGeo = new THREE.BoxGeometry(4.5, 2.6, 4.5);
                    const aptMat = new THREE.MeshStandardMaterial({
                        color: 0xcccccc,
                        roughness: 0.6,
                        metalness: 0.1
                    });
                    const aptMesh = new THREE.Mesh(aptGeo, aptMat);

                    const angle = (apt / aptsPerFloor) * Math.PI * 2;
                    const radius = 8;
                    aptMesh.position.set(
                        Math.cos(angle) * radius,
                        floor * 3 + 1.5,
                        Math.sin(angle) * radius
                    );
                    aptMesh.castShadow = true;
                    aptMesh.receiveShadow = true;

                    aptMesh.userData = {
                        id: floor * aptsPerFloor + apt,
                        floor: floor + 1,
                        rooms: 1 + Math.floor(Math.random() * 3),
                        area: 45 + Math.floor(Math.random() * 75),
                        price: 200000 + Math.floor(Math.random() * 400000)
                    };

                    sceneObjects.apartments.push(aptMesh);
                    sceneObjects.building.add(aptMesh);

                    // Windows
                    const windowGeo = new THREE.BoxGeometry(0.1, 1.8, 3);
                    const windowMat = new THREE.MeshPhysicalMaterial({
                        color: 0x88bbff,
                        transmission: 0.8,
                        thickness: 0.1,
                        roughness: 0.1,
                        transparent: true
                    });
                    const window1 = new THREE.Mesh(windowGeo, windowMat);
                    window1.position.copy(aptMesh.position);
                    window1.position.x += Math.cos(angle) * 2.3;
                    window1.position.z += Math.sin(angle) * 2.3;
                    window1.rotation.y = angle;
                    sceneObjects.building.add(window1);
                }
            }

            // Core structure
            const coreGeo = new THREE.CylinderGeometry(3, 3, floors * 3, 8);
            const coreMat = new THREE.MeshStandardMaterial({
                color: 0x666666,
                roughness: 0.7
            });
            const core = new THREE.Mesh(coreGeo, coreMat);
            core.position.y = (floors * 3) / 2;
            core.castShadow = true;
            core.receiveShadow = true;
            sceneObjects.building.add(core);

            scene.add(sceneObjects.building);
        }

        function createAmenities() {
            sceneObjects.amenities = {};

            // Playground
            const playgroundGeo = new THREE.BoxGeometry(12, 0.2, 12);
            const playgroundMat = new THREE.MeshStandardMaterial({ color: 0x88cc88 });
            const playground = new THREE.Mesh(playgroundGeo, playgroundMat);
            playground.position.set(-25, 0.1, 25);
            sceneObjects.amenities.playground = playground;
            scene.add(playground);

            // Parking
            const parkingGeo = new THREE.BoxGeometry(20, 8, 15);
            const parkingMat = new THREE.MeshStandardMaterial({ color: 0x555555 });
            const parking = new THREE.Mesh(parkingGeo, parkingMat);
            parking.position.set(25, 4, -30);
            sceneObjects.amenities.parking = parking;
            scene.add(parking);

            // Garden on roof
            const gardenGeo = new THREE.BoxGeometry(10, 0.5, 10);
            const gardenMat = new THREE.MeshStandardMaterial({ color: 0x66aa66 });
            const garden = new THREE.Mesh(gardenGeo, gardenMat);
            garden.position.set(0, 36.5, 0);
            sceneObjects.amenities.garden = garden;
            scene.add(garden);
        }

        function createInterior() {
            sceneObjects.interior = new THREE.Group();

            // Living room
            const wallMat = new THREE.MeshStandardMaterial({ color: 0xf5f5f5, roughness: 0.9 });
            const floorMat = new THREE.MeshStandardMaterial({ color: 0xc4a57b, roughness: 0.7 });

            // Floor
            const floor = new THREE.Mesh(new THREE.BoxGeometry(8, 0.1, 6), floorMat);
            floor.position.y = -0.05;
            sceneObjects.interior.add(floor);

            // Walls
            const wall1 = new THREE.Mesh(new THREE.BoxGeometry(8, 3, 0.1), wallMat);
            wall1.position.set(0, 1.5, -3);
            sceneObjects.interior.add(wall1);

            const wall2 = new THREE.Mesh(new THREE.BoxGeometry(0.1, 3, 6), wallMat);
            wall2.position.set(-4, 1.5, 0);
            sceneObjects.interior.add(wall2);

            const wall3 = new THREE.Mesh(new THREE.BoxGeometry(0.1, 3, 6), wallMat);
            wall3.position.set(4, 1.5, 0);
            sceneObjects.interior.add(wall3);

            // Furniture
            const sofaMat = new THREE.MeshStandardMaterial({ color: 0x334455, roughness: 0.8 });
            const sofa = new THREE.Mesh(new THREE.BoxGeometry(2, 0.6, 0.8), sofaMat);
            sofa.position.set(-2, 0.3, -2);
            sceneObjects.interior.add(sofa);

            const table = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.5, 0.8), new THREE.MeshStandardMaterial({ color: 0x8b4513, roughness: 0.6 }));
            table.position.set(0, 0.25, -0.5);
            sceneObjects.interior.add(table);

            sceneObjects.interior.visible = false;
            scene.add(sceneObjects.interior);
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function transitionCamera(targetPos, targetLook, duration = 2) {
            if (animating) return;
            animating = true;

            gsap.to(camera.position, {
                x: targetPos[0],
                y: targetPos[1],
                z: targetPos[2],
                duration: duration,
                ease: 'power2.inOut',
                onUpdate: () => {
                    camera.lookAt(...targetLook);
                },
                onComplete: () => {
                    animating = false;
                }
            });
        }

        function startExperience() {
            document.getElementById('hero-screen').classList.add('hidden');
            nextScene();
        }

        function nextScene() {
            if (currentScene < Object.keys(SCENES).length - 1) {
                currentScene++;
                updateScene();
            }
        }

        function previousScene() {
            if (currentScene > 1) {
                currentScene--;
                updateScene();
            }
        }

        function updateScene() {
            const sceneConfig = SCENES[currentScene];

            // Update title
            const titleEl = document.getElementById('scene-title');
            titleEl.textContent = sceneConfig.name.replace('_', ' ');
            titleEl.classList.add('visible');

            // Camera transition
            transitionCamera(sceneConfig.camera.pos, sceneConfig.camera.look);

            // UI updates
            document.getElementById('stats-panel').classList.remove('visible');
            document.getElementById('filter-panel').classList.remove('visible');
            document.getElementById('floorplan-panel').classList.remove('visible');
            document.getElementById('amenities-menu').classList.remove('visible');
            document.getElementById('nav-controls').classList.add('visible');

            // Interior visibility
            sceneObjects.interior.visible = currentScene === 6;
            sceneObjects.building.visible = currentScene !== 6;

            // Scene-specific UI
            if (currentScene === 1) {
                setTimeout(() => document.getElementById('stats-panel').classList.add('visible'), 800);
            } else if (currentScene === 3 || currentScene === 4) {
                setTimeout(() => document.getElementById('filter-panel').classList.add('visible'), 800);
            } else if (currentScene === 7) {
                setTimeout(() => document.getElementById('amenities-menu').classList.add('visible'), 800);
            }
        }

        function filterApartments() {
            const selectedRooms = parseInt(document.querySelector('.room-btn.active').dataset.rooms);

            sceneObjects.apartments.forEach(apt => {
                if (apt.userData.rooms === selectedRooms) {
                    apt.material.emissive.setHex(0x223344);
                    apt.material.emissiveIntensity = 0.3;
                } else {
                    apt.material.emissive.setHex(0x000000);
                    apt.material.opacity = 0.3;
                }
            });
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            if (currentScene === 4 || currentScene === 5) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(sceneObjects.apartments);

                const tooltip = document.getElementById('apt-tooltip');
                if (intersects.length > 0) {
                    const apt = intersects[0].object;
                    tooltip.innerHTML = `Apartment #${apt.userData.id}<br>${apt.userData.rooms} Rooms | ${apt.userData.area}m²`;
                    tooltip.style.left = event.clientX + 15 + 'px';
                    tooltip.style.top = event.clientY + 15 + 'px';
                    tooltip.classList.add('visible');

                    apt.material.emissive.setHex(0xffffff);
                    apt.material.emissiveIntensity = 0.2;
                } else {
                    tooltip.classList.remove('visible');
                    sceneObjects.apartments.forEach(a => {
                        a.material.emissive.setHex(0x000000);
                    });
                }
            }
        }

        function onMouseClick(event) {
            if (currentScene === 5) {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(sceneObjects.apartments);

                if (intersects.length > 0) {
                    selectedApartment = intersects[0].object;
                    document.getElementById('floorplan-panel').classList.add('visible');
                }
            }
        }

        function goToRoom(room) {
            currentScene = 6;
            updateScene();
        }

        function startWalkthrough() {
            currentScene = 6;
            updateScene();
        }

        function showAmenity(amenity) {
            const positions = {
                playground: [[-25, 15, 25], [-25, 5, 25]],
                garden: [[0, 45, 15], [0, 37, 0]],
                parking: [[25, 15, -30], [25, 4, -30]]
            };

            if (positions[amenity]) {
                transitionCamera(positions[amenity][0], positions[amenity][1]);
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Start
        window.addEventListener('load', init);
    </script>
</body>
</html>